#!/usr/bin/env node

"use strict";

var vessel 	= {}
,	debug 		= false
,	fs 			  = require('fs')
,	nomnom 	 	= require('nomnom')
;

/** OPTIONS **/
nomnom.option('serial', {
	abbr: 's',
	default: null,
	help: 'Attach the Parser directly to a serial port.'
});

nomnom.option('baudrate', {
	abbr: 'b',
	default: 4800,
	help: 'Baudrate for serial port.'
});

nomnom.option('file', {
	abbr: 'f',
	default: null,
	help: 'Directly stream a file into the Parser.'
});

nomnom.option('line', {
	abbr: 'l',
	default: null,
	help: 'Parse a single line and exit.'
});

nomnom.option('vessel', {
	abbr: 'v',
	help: 'Location of the vessel.json file, containg information about the local environment.',
	default: '~/vessel.json'
});

nomnom.option('debug', {
	abbr: 'd',
	flag: true,
	default: false,
	help: "Run the Parser in debug mode."
});

// Parse the defined options
var argv = nomnom.parse();

if(argv.vessel) {
	if(fs.existsSync(argv.vessel)) {
		vessel = require(argv.vessel);
	}
}

if(argv.debug) {
	debug = !!argv.debug;
}

if(!!process.stdin.isTTY === false) {
	return require('../modes/pipe')(argv, vessel, debug);
}

if(typeof process.send === 'function') {
	return require('../modes/fork')(argv, vessel, debug); 
}

return require('../modes/standalone')(argv, vessel, debug);



